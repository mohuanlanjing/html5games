<!doctype html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>躲避星星</title>
    <script type="text/javascript" src="phaser.min.js"></script>
    <style type="text/css">
        canvas {
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body>
<body>
    <script>
        var game = new Phaser.Game(600, 450, Phaser.AUTO, '', { preload: preload, create: create, update: update });
        var basecount = 10;
        var before_time = 0;
        var score = 0;
        var scoreText;
        var move_speed = 150
        function preload() {
            game.load.image('plane', 'pic/plane.jpg');
            game.load.image('star', 'pic/star.png');
            //game.load.spritesheet('ghost', 'pic/baddie.png', 32, 32);
        }

        function create() {
            game.physics.startSystem(Phaser.Physics.ARCADE);
            player = game.add.sprite(290, game.world.height-220, 'plane');
            game.physics.arcade.enable(player);
            player.body.collideWorldBounds = true;

            stars = game.add.group();
            stars.enableBody = true;

            create_randomstar(stars, basecount);
            scoreText = game.add.text(10, 10, '生存时间: 0s', { fontSize: '22px', fill: '#999'});
        }

        function update() {
            game.physics.arcade.collide(player, stars, GameOver);
            //game.physics.arcade.overlap(player, stars, GameOver, null, this);
            player.body.velocity.x = 0;
            player.body.velocity.y = 0;
            if (game.time.now - before_time > 3000) {
                before_time = game.time.now;
                basecount = parseInt(basecount * 1.2);
                create_randomstar(stars, basecount);
            }

            cursors = game.input.keyboard.createCursorKeys();
            if (cursors.left.isDown){
                player.body.velocity.x = -move_speed;
            }
            if (cursors.right.isDown){
                player.body.velocity.x = move_speed;
            }
            if (cursors.up.isDown){
                player.body.velocity.y = -move_speed;
            }
            if (cursors.down.isDown){
                player.body.velocity.y = move_speed;
            }
            scoreText.text = '生存时间: ' + game.time.now/1000 + "s";

        }

        function GameOver(player) {
            game.paused = true;
        }

        function getspeed(base) {
            return Math.random()*base;
        }

        function create_randomstar(stars, n) {
            for (var i=0; i<n; i++){
                var star = stars.create(Math.random()*game.world.width, 0, 'star');
                star.body.gravity.y = getspeed(100);
                star.body.gravity.x = getspeed(150);
                //star.body.bounce.y = 0.7 + Math.random() * 0.2;
                star = stars.create(0, Math.random()*game.world.height, 'star');
                star.body.gravity.y = getspeed(150);
                star.body.gravity.x = getspeed(100);

                var star = stars.create(game.world.width, Math.random()*game.world.height, 'star');
                star.body.gravity.y = getspeed(100);
                star.body.gravity.x = getspeed(-150);

                var star = stars.create(Math.random()*game.world.width, game.world.height, 'star');
                star.body.gravity.y = getspeed(-100);
                star.body.gravity.x = getspeed(150);
            }
        }
    </script>
</body>
